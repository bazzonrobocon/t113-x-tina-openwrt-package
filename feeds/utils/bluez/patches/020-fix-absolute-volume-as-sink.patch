From e3b5abc9107c0c5db716278b2a8ccb0d0efa3aa9 Mon Sep 17 00:00:00 2001
From: luoyuyi <luoyuyi@allwinnertech.com>
Date: Tue, 14 Mar 2023 19:40:02 +0800
Subject: [PATCH] fix absolute volume as sink

---
 profiles/audio/avrcp.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/profiles/audio/avrcp.c b/profiles/audio/avrcp.c
index 6b3f685..fa3aff6 100644
--- a/profiles/audio/avrcp.c
+++ b/profiles/audio/avrcp.c
@@ -3962,6 +3962,7 @@ static void target_init(struct avrcp *session)
 				(1 << AVRCP_EVENT_TRACK_CHANGED) |
 				(1 << AVRCP_EVENT_TRACK_REACHED_START) |
 				(1 << AVRCP_EVENT_TRACK_REACHED_END) |
+				(1 << AVRCP_EVENT_VOLUME_CHANGED) |
 				(1 << AVRCP_EVENT_SETTINGS_CHANGED);
 
 	if (target->version < 0x0104)
@@ -4009,6 +4010,7 @@ static void controller_init(struct avrcp *session)
 	if (controller->version < 0x0103)
 		return;
 
+	session->supported_events |= (1 << AVRCP_EVENT_VOLUME_CHANGED);
 	avrcp_get_capabilities(session);
 
 	if (controller->version < 0x0104)
@@ -4364,8 +4366,8 @@ int avrcp_set_volume(struct btd_device *dev, uint8_t volume, bool notify)
 		return -ENOTCONN;
 
 	if (notify) {
-		if (!session->target)
-			return -ENOTSUP;
+		// if (!session->target)
+		// 	return -ENOTSUP;
 		return avrcp_event(session, AVRCP_EVENT_VOLUME_CHANGED,
 								&volume);
 	}
-- 
2.29.0

